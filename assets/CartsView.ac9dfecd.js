import{e as d}from"./emitter.2ccbb68b.js";import{S as V}from"./SweetAlert.60786bef.js";import{_ as C,r as p,o as _,a as u,d as i,b as s,F as w,y as $,w as k,t as h,e as g,A as L,n as y}from"./index.e5e6e3c4.js";const P={data(){return{VUE_APP:"https://vue3-course-api.hexschool.io/v2/api/groen",isLoading:!1,total:0,final_total:0,carts:[],order:{user:{name:"",email:"",tel:"",address:""},message:""}}},components:{SweetAlert:V},methods:{getCarts(){this.isLoading=!0;const r=`${this.VUE_APP}/cart`;this.$http.get(r).then(e=>{console.log(e.data.data),this.isLoading=!1,this.total=e.data.data.total,this.final_total=e.data.data.final_total;const b=e.data.data.carts,m=[];b.forEach(t=>{if(t.files===void 0||t.files.length<=1)m.push(t);else{const n=t.files.length;for(let a=0;a<n;a++){const l={...t};l.files=[t.files[a]],l.files[0].id=a+1,m.push(l)}}}),this.carts=m,d.emit("cartCount")}).catch(e=>{this.isLoading=!1,d.emit("sweetalert",`${e.response.data.message}, error`)})},clearCarts(){this.isLoading=!0;const r=`${this.VUE_APP}/carts`;this.$http.delete(r).then(e=>{this.isLoading=!1,d.emit("sweetalert",`${e.data.message}, success`),this.getCarts()}).catch(e=>{this.isLoading=!1,d.emit("sweetalert",`${e.response.data.message}, error`)})},delCart(r,e){this.isLoading=!0;const b=`${this.VUE_APP}/cart`;this.$http.get(b).then(m=>{const n=m.data.data.carts.find(a=>a.product_id===r.product_id);if(n.files===void 0||n.files.length<=1){const a=`https://vue3-course-api.hexschool.io/v2/api/groen/cart/${r.id}`;this.$http.delete(a).then(l=>{this.isLoading=!1,d.emit("sweetalert",`${l.data.message}, success`),this.getCarts()}).catch(l=>{this.isLoading=!1,d.emit("sweetalert",`${l.response.data.message}, error`)})}else{n.files.splice(e-1,1);const a=`https://vue3-course-api.hexschool.io/v2/api/groen/cart/${r.id}`;this.$http.put(a,{data:{product_id:n.id,qty:1,files:n.files}}).then(l=>{this.isLoading=!1,d.emit("sweetalert",`${l.data.message}, success`),this.getCarts()}).catch(l=>{this.isLoading=!1,d.emit("sweetalert",`${l.response.data.message}, error`)})}}).catch(m=>{this.isLoading=!1,d.emit("sweetalert",`${m.response.data.message}, error`)})},onSubmit(){this.isLoading=!0;const r=`${this.VUE_APP}/order`;this.$http.post(r,{data:{...this.order}}).then(e=>{this.isLoading=!1,d.emit("sweetalert",`${e.data.message}, success`),this.getCarts(),this.$refs.form.resetForm()}).catch(e=>{this.isLoading=!1,d.emit("sweetalert",`${e.response.data.message}, error`)})}},mounted(){this.getCarts()}},U={class:"container mt-5"},A=s("h1",{class:"fs-4 text-dark mb-3"},[s("span",{class:"material-symbols-sharp me-2 align-middle"},"shopping_cart"),g("\u8CFC\u7269\u8ECA ")],-1),E={class:"row g-4"},S={class:"col-lg-8 col-12"},j={class:"mb-3 border"},q={class:"px-4 py-2 bg-gray-100 fw-bold d-flex justify-content-between border-bottom"},B=s("span",null,"\u9805\u76EE",-1),F=["disabled"],N={key:0,class:"p-4 text-secondary"},I={key:1},M={class:"d-xl-flex"},z={class:"mb-xl-0 mb-4 me-3"},D={key:0,style:{height:"100px"}},T={key:1},X=["src"],G=["src"],H={class:"fw-bold mb-2"},J=s("br",null,null,-1),K={class:"text-secondary fs-7"},O=s("br",null,null,-1),Q={class:"text-nowrap"},R=["onClick"],W=s("span",{class:"material-symbols-outlined align-middle"},"delete",-1),Y=[W],Z={class:"border"},ss=s("div",{class:"px-4 py-2 fw-bold bg-gray-100"}," \u6536\u4EF6\u4EBA ",-1),es={class:"py-4 row justify-content-center"},ts={class:"col-xl-6 col-sm-8 col-10"},os={class:"mb-2"},ls=s("label",{for:"name",class:"form-label fs-7"},"\u59D3\u540D",-1),as={class:"mb-2"},is=s("label",{for:"email",class:"form-label fs-7"},"Email",-1),ns={class:"mb-2"},ds=s("label",{for:"tel",class:"form-label fs-7"},"\u96FB\u8A71",-1),rs={class:"mb-2"},cs=s("label",{for:"address",class:"form-label fs-7"},"\u5730\u5740",-1),hs={class:"mb-4"},ms=s("label",{for:"message",class:"form-label fs-7"},"\u8A02\u55AE\u5099\u8A3B",-1),_s=s("div",{class:"d-grid"},[s("button",{type:"submit",class:"btn btn-primary"},"\u7D50\u5E33")],-1),us={class:"col-lg col-12"},fs={class:"border bg-gray-100 sticky-top"},ps=s("div",{class:"p-2 text-center bg-gray-200"}," \u8A02\u55AE\u6458\u8981 ",-1),gs={class:"p-3"},bs={class:"d-flex justify-content-between"},vs=s("div",null,"\u5546\u54C1\u7E3D\u8A08",-1),ys=s("div",{class:"d-flex justify-content-between"},[s("div",null,"\u904B\u8CBB\u7E3D\u8A08"),s("div",null,"\u514D\u904B\u8CBB")],-1),ws={class:"p-3 d-flex justify-content-between"},xs=s("div",null,"\u7D50\u5E33\u7E3D\u91D1\u984D",-1),Vs={class:"fw-bolder text-danger"},Cs={class:"fs-5"};function $s(r,e,b,m,t,n){const a=p("v-loading"),l=p("SweetAlert"),f=p("v-field"),v=p("error-message"),x=p("v-form");return _(),u(w,null,[i(a,{active:t.isLoading},null,8,["active"]),i(l),s("div",U,[A,s("div",E,[s("div",S,[s("div",j,[s("div",q,[B,s("button",{class:"btn btn-sm btn-outline-secondary",onClick:e[0]||(e[0]=o=>n.clearCarts()),disabled:t.carts.length<=0},"\u6E05\u9664\u8CFC\u7269\u8ECA",8,F)]),s("div",null,[t.carts.length<=0?(_(),u("p",N,"\u8CFC\u7269\u8ECA\u5C1A\u7121\u5167\u5BB9")):(_(),u("div",I,[(_(!0),u(w,null,$(t.carts,o=>(_(),u("div",{key:o.id,class:"p-4 d-flex justify-content-between align-items-center"},[s("div",M,[s("div",z,[o.files===void 0?(_(),u("div",D," \xA0 ")):(_(),u("div",T,[s("img",{src:o.files[0].front,class:"border",height:"100",alt:""},null,8,X),g("\xA0 "),s("img",{src:o.files[0].back,class:"border",height:"100",alt:""},null,8,G)]))]),s("div",null,[s("span",H,h(o.product.title),1),J,s("span",K,[g(h(o.product.width)+" mm X "+h(o.product.height)+" mm ",1),O,g(" "+h(o.product.side)+" \uFF0F "+h(o.product.material)+" \uFF0F "+h(o.product.p_qty)+" "+h(o.product.unit),1)])])]),s("div",Q,"$ "+h(o.product.price),1),s("div",null,[s("a",{href:"#",class:"btn btn-sm btn-link",onClick:L(c=>n.delCart(o,o.files[0].id),["prevent"])},Y,8,R)])]))),128))]))])]),s("div",Z,[ss,s("div",es,[s("div",ts,[i(x,{class:"py-4",ref:"form",onSubmit:n.onSubmit},{default:k(({errors:o})=>[s("div",os,[ls,i(f,{name:"\u59D3\u540D",id:"name",type:"text",rules:"required",class:y(["form-control",{"is-invalid":o.\u59D3\u540D}]),modelValue:t.order.user.name,"onUpdate:modelValue":e[1]||(e[1]=c=>t.order.user.name=c),placeholder:"\u586B\u5165\u59D3\u540D"},null,8,["class","modelValue"]),i(v,{name:"\u59D3\u540D",class:"invalid-feedback"})]),s("div",as,[is,i(f,{name:"email",id:"email",type:"email",rules:"required|email",class:y(["form-control",{"is-invalid":o.email}]),modelValue:t.order.user.email,"onUpdate:modelValue":e[2]||(e[2]=c=>t.order.user.email=c),placeholder:"\u586B\u5165 Email"},null,8,["class","modelValue"]),i(v,{name:"email",class:"invalid-feedback"})]),s("div",ns,[ds,i(f,{name:"\u96FB\u8A71",id:"tel",type:"tel",rules:"required|numeric|min:7|max:10",class:y(["form-control",{"is-invalid":o.\u96FB\u8A71}]),modelValue:t.order.user.tel,"onUpdate:modelValue":e[3]||(e[3]=c=>t.order.user.tel=c)},null,8,["class","modelValue"]),i(v,{name:"\u96FB\u8A71",class:"invalid-feedback"})]),s("div",rs,[cs,i(f,{name:"\u5730\u5740",id:"address",type:"text",rules:"required",class:y(["form-control",{"is-invalid":o.\u5730\u5740}]),modelValue:t.order.user.address,"onUpdate:modelValue":e[4]||(e[4]=c=>t.order.user.address=c)},null,8,["class","modelValue"]),i(v,{name:"\u5730\u5740",class:"invalid-feedback"})]),s("div",hs,[ms,i(f,{as:"textarea",name:"message",id:"message",class:"form-control",rows:"3",modelValue:t.order.message,"onUpdate:modelValue":e[5]||(e[5]=c=>t.order.message=c)},null,8,["modelValue"])]),_s]),_:1},8,["onSubmit"])])])])]),s("div",us,[s("div",fs,[ps,s("div",gs,[s("div",bs,[vs,s("div",null,"$ "+h(t.total),1)]),ys]),s("div",ws,[xs,s("div",Vs,[g("$ "),s("span",Cs,h(Math.round(t.final_total)),1)])])])])])])],64)}const Us=C(P,[["render",$s]]);export{Us as default};
